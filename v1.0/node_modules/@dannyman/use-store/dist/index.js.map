{"version":3,"file":"index.js","sources":["../src/functions.js","../src/index.js"],"sourcesContent":["// Private Functions\nconst isSameType = (value1, value2) => typeof value1 === typeof value2;\n\nconst isNumber = (value) => !isNaN(value);\n\nconst isArray = (value) => Array.isArray(value);\n\nconst isObject = (value) => typeof value === 'object';\n\nconst isString = (value) => typeof value === 'string';\n\nconst isTheSameObject = (object1, object2) => JSON.stringify(Object.values(object1).sort()) === JSON.stringify(Object.values(object2).sort());\n\nconst isTheSameArray = (arr1, arr2) => (arr1 && arr2) && (arr1.length === arr2.length) && arr1.every(value1 => arr2.some((value2) => isTheSameObject(value1, value2)));\n\nconst isNullOrUndefined = (value) => (typeof value === 'undefined' || value === null);\n\nconst isFunction = (value) => (typeof value === 'function');\n\n// Consts\nconst ssrStateMock = [false, () => false];\n\nconst isBrowser = (typeof window !== 'undefined');\n\nconst validations = {\n    isSameType,\n    isNumber,\n    isArray,\n    isObject,\n    isString,\n    isTheSameObject,\n    isTheSameArray,\n    isNullOrUndefined,\n    isFunction\n};\n\n// Public Functions\n\nconst set = (storage, key, value) => storage.setItem(key, btoa(JSON.stringify(value)));\n\nconst get = (storage, key) => {\n    const raw = storage.getItem(key);\n    return (raw && raw.length) ? JSON.parse(atob(raw)) : false;\n};\n\nconst refresh = (callback) => setInterval(callback, 500);\n\nconst getValidOptions = (options) => ({\n    autoRefresh: options?.autoRefresh || false,\n    debug: options?.debug || false,\n    isNew: options?.isNew || false,\n});\n\nconst stateShouldUpdate = (state, newState) => {\n    switch (true) {\n        case !isSameType(state, newState):\n        case (isObject(newState) && !isNullOrUndefined(newState) && !isTheSameObject(state, newState)):\n        case (isArray(newState) && !isTheSameArray(state, newState)):\n        case ((isString(newState) || isNumber(newState)) && state !== newState):\n            return true;\n        default:\n            return false;\n    }\n};\n\nconst writeToLog = (debug, key) => {\n    return debug ?\n        (message, object = () => { }, err = false) => {\n            console.group(`[@dannyman/use-store]@%c${key}`, 'color: blue;');\n\n            if (message) console.log(`${err ? '%cERROR: ' : '%c'}${message}`, `color: ${err ? 'red' : 'green'};`);\n            if (!isFunction(object)) console.log(`${typeof object} =>`, JSON.parse(JSON.stringify(object)));\n\n            console.groupEnd();\n        } : () => { };\n};\n\nconst isSSR = () => (!isBrowser ? ssrStateMock : false);\n\nexport {\n    validations,\n    ssrStateMock,\n    set,\n    get,\n    refresh,\n    getValidOptions,\n    stateShouldUpdate,\n    writeToLog,\n    isSSR\n};","// Imports\nimport {\n  useState,\n  useEffect,\n  useLayoutEffect,\n  useCallback\n} from 'react';\nimport {\n  validations,\n  refresh,\n  set,\n  get,\n  getValidOptions,\n  stateShouldUpdate,\n  writeToLog,\n  isSSR\n} from './functions';\n\n// Private functions\n\nconst handleState = (storage, key, defaultValue = false, options) => {\n  const {\n    autoRefresh,\n    isNew,\n    debug,\n  } = getValidOptions(options);\n\n  const log = useCallback(writeToLog(debug, key));\n\n  const [state, setState] = useState(() => {\n    if (validations.isFunction(defaultValue)) {\n      log('The defaultValue cannot be a function.', defaultValue, true);\n      defaultValue = false;\n    }\n\n    const existentValue = get(storage, key);\n    const _defaultValue = !isNew ? (existentValue !== null) ? existentValue : defaultValue : defaultValue;\n    log('Default Value:', _defaultValue);\n    return _defaultValue;\n  });\n\n  useEffect(() => {\n    log('Updated value:', state);\n    set(storage, key, state);\n  }, [key, state]);\n\n  useLayoutEffect(() => {\n    if (autoRefresh) {\n      const interval = refresh(() => {\n        const newState = get(storage, key);\n        if (stateShouldUpdate(state, newState)) {\n          log('Auto refresh updating.');\n          setState(newState);\n        }\n      });\n\n      return () => clearInterval(interval);\n    }\n  }, [state]);\n\n  return [state, setState];\n};\n\n// Public functions\nconst usePersistedState = (key, defaultValue, options) => isSSR() || handleState(localStorage, key, defaultValue, options);\nconst useSessionState = (key, defaultValue, options) => isSSR() || handleState(sessionStorage, key, defaultValue, options);\n\n// Exports\nexport {\n  usePersistedState,\n  useSessionState\n};"],"names":["isSameType","value1","value2","isNumber","value","isNaN","isArray","Array","isObject","isString","isTheSameObject","object1","object2","JSON","stringify","Object","values","sort","isTheSameArray","arr1","arr2","length","every","some","isNullOrUndefined","isFunction","ssrStateMock","isBrowser","window","validations","set","storage","key","setItem","btoa","get","raw","getItem","parse","atob","refresh","callback","setInterval","getValidOptions","options","autoRefresh","debug","isNew","stateShouldUpdate","state","newState","writeToLog","message","object","err","console","group","log","groupEnd","isSSR","handleState","defaultValue","useCallback","useState","existentValue","_defaultValue","setState","useEffect","useLayoutEffect","interval","clearInterval","usePersistedState","localStorage","useSessionState","sessionStorage"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA,IAAMA,UAAU,GAAG,SAAbA,UAAa,CAACC,MAAD,EAASC,MAAT;AAAA,SAAoB,QAAOD,MAAP,cAAyBC,MAAzB,CAApB;AAAA,CAAnB;;AAEA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CAACC,KAAD;AAAA,SAAW,CAACC,KAAK,CAACD,KAAD,CAAjB;AAAA,CAAjB;;AAEA,IAAME,OAAO,GAAG,SAAVA,OAAU,CAACF,KAAD;AAAA,SAAWG,KAAK,CAACD,OAAN,CAAcF,KAAd,CAAX;AAAA,CAAhB;;AAEA,IAAMI,QAAQ,GAAG,SAAXA,QAAW,CAACJ,KAAD;AAAA,SAAW,QAAOA,KAAP,MAAiB,QAA5B;AAAA,CAAjB;;AAEA,IAAMK,QAAQ,GAAG,SAAXA,QAAW,CAACL,KAAD;AAAA,SAAW,OAAOA,KAAP,KAAiB,QAA5B;AAAA,CAAjB;;AAEA,IAAMM,eAAe,GAAG,SAAlBA,eAAkB,CAACC,OAAD,EAAUC,OAAV;AAAA,SAAsBC,IAAI,CAACC,SAAL,CAAeC,MAAM,CAACC,MAAP,CAAcL,OAAd,EAAuBM,IAAvB,EAAf,MAAkDJ,IAAI,CAACC,SAAL,CAAeC,MAAM,CAACC,MAAP,CAAcJ,OAAd,EAAuBK,IAAvB,EAAf,CAAxE;AAAA,CAAxB;;AAEA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAACC,IAAD,EAAOC,IAAP;AAAA,SAAiBD,IAAI,IAAIC,IAAT,IAAmBD,IAAI,CAACE,MAAL,KAAgBD,IAAI,CAACC,MAAxC,IAAmDF,IAAI,CAACG,KAAL,CAAW,UAAArB,MAAM;AAAA,WAAImB,IAAI,CAACG,IAAL,CAAU,UAACrB,MAAD;AAAA,aAAYQ,eAAe,CAACT,MAAD,EAASC,MAAT,CAA3B;AAAA,KAAV,CAAJ;AAAA,GAAjB,CAAnE;AAAA,CAAvB;;AAEA,IAAMsB,iBAAiB,GAAG,SAApBA,iBAAoB,CAACpB,KAAD;AAAA,SAAY,OAAOA,KAAP,KAAiB,WAAjB,IAAgCA,KAAK,KAAK,IAAtD;AAAA,CAA1B;;AAEA,IAAMqB,UAAU,GAAG,SAAbA,UAAa,CAACrB,KAAD;AAAA,SAAY,OAAOA,KAAP,KAAiB,UAA7B;AAAA,CAAnB;;;AAGA,IAAMsB,YAAY,GAAG,CAAC,KAAD,EAAQ;AAAA,SAAM,KAAN;AAAA,CAAR,CAArB;AAEA,IAAMC,SAAS,GAAI,OAAOC,MAAP,KAAkB,WAArC;AAEA,IAAMC,WAAW,GAAG;AAChB7B,EAAAA,UAAU,EAAVA,UADgB;AAEhBG,EAAAA,QAAQ,EAARA,QAFgB;AAGhBG,EAAAA,OAAO,EAAPA,OAHgB;AAIhBE,EAAAA,QAAQ,EAARA,QAJgB;AAKhBC,EAAAA,QAAQ,EAARA,QALgB;AAMhBC,EAAAA,eAAe,EAAfA,eANgB;AAOhBQ,EAAAA,cAAc,EAAdA,cAPgB;AAQhBM,EAAAA,iBAAiB,EAAjBA,iBARgB;AAShBC,EAAAA,UAAU,EAAVA;AATgB,CAApB;;AAcA,IAAMK,GAAG,GAAG,SAANA,GAAM,CAACC,OAAD,EAAUC,GAAV,EAAe5B,KAAf;AAAA,SAAyB2B,OAAO,CAACE,OAAR,CAAgBD,GAAhB,EAAqBE,IAAI,CAACrB,IAAI,CAACC,SAAL,CAAeV,KAAf,CAAD,CAAzB,CAAzB;AAAA,CAAZ;;AAEA,IAAM+B,GAAG,GAAG,SAANA,GAAM,CAACJ,OAAD,EAAUC,GAAV,EAAkB;AAC1B,MAAMI,GAAG,GAAGL,OAAO,CAACM,OAAR,CAAgBL,GAAhB,CAAZ;AACA,SAAQI,GAAG,IAAIA,GAAG,CAACf,MAAZ,GAAsBR,IAAI,CAACyB,KAAL,CAAWC,IAAI,CAACH,GAAD,CAAf,CAAtB,GAA8C,KAArD;AACH,CAHD;;AAKA,IAAMI,OAAO,GAAG,SAAVA,OAAU,CAACC,QAAD;AAAA,SAAcC,WAAW,CAACD,QAAD,EAAW,GAAX,CAAzB;AAAA,CAAhB;;AAEA,IAAME,eAAe,GAAG,SAAlBA,eAAkB,CAACC,OAAD;AAAA,SAAc;AAClCC,IAAAA,WAAW,EAAE,CAAAD,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEC,WAAT,KAAwB,KADH;AAElCC,IAAAA,KAAK,EAAE,CAAAF,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEE,KAAT,KAAkB,KAFS;AAGlCC,IAAAA,KAAK,EAAE,CAAAH,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEG,KAAT,KAAkB;AAHS,GAAd;AAAA,CAAxB;;AAMA,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,KAAD,EAAQC,QAAR,EAAqB;AAC3C,UAAQ,IAAR;AACI,SAAK,CAAClD,UAAU,CAACiD,KAAD,EAAQC,QAAR,CAAhB;AACA,SAAM1C,QAAQ,CAAC0C,QAAD,CAAR,IAAsB,CAAC1B,iBAAiB,CAAC0B,QAAD,CAAxC,IAAsD,CAACxC,eAAe,CAACuC,KAAD,EAAQC,QAAR,CAA5E;AACA,SAAM5C,OAAO,CAAC4C,QAAD,CAAP,IAAqB,CAAChC,cAAc,CAAC+B,KAAD,EAAQC,QAAR,CAA1C;AACA,SAAM,CAACzC,QAAQ,CAACyC,QAAD,CAAR,IAAsB/C,QAAQ,CAAC+C,QAAD,CAA/B,KAA8CD,KAAK,KAAKC,QAA9D;AACI,aAAO,IAAP;;AACJ;AACI,aAAO,KAAP;AAPR;AASH,CAVD;;AAYA,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACL,KAAD,EAAQd,GAAR,EAAgB;AAC/B,SAAOc,KAAK,GACR,UAACM,OAAD,EAA8C;AAAA,QAApCC,MAAoC,uEAA3B,YAAM,EAAqB;AAAA,QAAhBC,GAAgB,uEAAV,KAAU;AAC1CC,IAAAA,OAAO,CAACC,KAAR,mCAAyCxB,GAAzC,GAAgD,cAAhD;AAEA,QAAIoB,OAAJ,EAAaG,OAAO,CAACE,GAAR,WAAeH,GAAG,GAAG,WAAH,GAAiB,IAAnC,SAA0CF,OAA1C,oBAA+DE,GAAG,GAAG,KAAH,GAAW,OAA7E;AACb,QAAI,CAAC7B,UAAU,CAAC4B,MAAD,CAAf,EAAyBE,OAAO,CAACE,GAAR,mBAAsBJ,MAAtB,WAAmCxC,IAAI,CAACyB,KAAL,CAAWzB,IAAI,CAACC,SAAL,CAAeuC,MAAf,CAAX,CAAnC;AAEzBE,IAAAA,OAAO,CAACG,QAAR;AACH,GARO,GAQJ,YAAM,EARd;AASH,CAVD;;AAYA,IAAMC,KAAK,GAAG,SAARA,KAAQ;AAAA,SAAO,CAAChC,SAAD,GAAaD,YAAb,GAA4B,KAAnC;AAAA,CAAd;;ACzDA,IAAMkC,WAAW,GAAG,SAAdA,WAAc,CAAC7B,OAAD,EAAUC,GAAV,EAAiD;AAAA,MAAlC6B,YAAkC,uEAAnB,KAAmB;AAAA,MAAZjB,OAAY;;AAAA,yBAK/DD,eAAe,CAACC,OAAD,CALgD;AAAA,MAEjEC,WAFiE,oBAEjEA,WAFiE;AAAA,MAGjEE,KAHiE,oBAGjEA,KAHiE;AAAA,MAIjED,KAJiE,oBAIjEA,KAJiE;;AAOnE,MAAMW,GAAG,GAAGK,iBAAW,CAACX,UAAU,CAACL,KAAD,EAAQd,GAAR,CAAX,CAAvB;;AAPmE,kBASzC+B,cAAQ,CAAC,YAAM;AACvC,QAAIlC,WAAW,CAACJ,UAAZ,CAAuBoC,YAAvB,CAAJ,EAA0C;AACxCJ,MAAAA,GAAG,CAAC,wCAAD,EAA2CI,YAA3C,EAAyD,IAAzD,CAAH;AACAA,MAAAA,YAAY,GAAG,KAAf;AACD;;AAED,QAAMG,aAAa,GAAG7B,GAAG,CAACJ,OAAD,EAAUC,GAAV,CAAzB;;AACA,QAAMiC,aAAa,GAAG,CAAClB,KAAD,GAAUiB,aAAa,KAAK,IAAnB,GAA2BA,aAA3B,GAA2CH,YAApD,GAAmEA,YAAzF;;AACAJ,IAAAA,GAAG,CAAC,gBAAD,EAAmBQ,aAAnB,CAAH;AACA,WAAOA,aAAP;AACD,GAViC,CATiC;AAAA;AAAA,MAS5DhB,KAT4D;AAAA,MASrDiB,QATqD;;AAqBnEC,EAAAA,eAAS,CAAC,YAAM;AACdV,IAAAA,GAAG,CAAC,gBAAD,EAAmBR,KAAnB,CAAH;AACAnB,IAAAA,GAAG,CAACC,OAAD,EAAUC,GAAV,EAAeiB,KAAf,CAAH;AACD,GAHQ,EAGN,CAACjB,GAAD,EAAMiB,KAAN,CAHM,CAAT;AAKAmB,EAAAA,qBAAe,CAAC,YAAM;AACpB,QAAIvB,WAAJ,EAAiB;AACf,UAAMwB,QAAQ,GAAG7B,OAAO,CAAC,YAAM;AAC7B,YAAMU,QAAQ,GAAGf,GAAG,CAACJ,OAAD,EAAUC,GAAV,CAApB;;AACA,YAAIgB,iBAAiB,CAACC,KAAD,EAAQC,QAAR,CAArB,EAAwC;AACtCO,UAAAA,GAAG,CAAC,wBAAD,CAAH;AACAS,UAAAA,QAAQ,CAAChB,QAAD,CAAR;AACD;AACF,OANuB,CAAxB;AAQA,aAAO;AAAA,eAAMoB,aAAa,CAACD,QAAD,CAAnB;AAAA,OAAP;AACD;AACF,GAZc,EAYZ,CAACpB,KAAD,CAZY,CAAf;AAcA,SAAO,CAACA,KAAD,EAAQiB,QAAR,CAAP;AACD,CAzCD;;;AA4CA,IAAMK,iBAAiB,GAAG,SAApBA,iBAAoB,CAACvC,GAAD,EAAM6B,YAAN,EAAoBjB,OAApB;AAAA,SAAgCe,KAAK,MAAMC,WAAW,CAACY,YAAD,EAAexC,GAAf,EAAoB6B,YAApB,EAAkCjB,OAAlC,CAAtD;AAAA,CAA1B;;AACA,IAAM6B,eAAe,GAAG,SAAlBA,eAAkB,CAACzC,GAAD,EAAM6B,YAAN,EAAoBjB,OAApB;AAAA,SAAgCe,KAAK,MAAMC,WAAW,CAACc,cAAD,EAAiB1C,GAAjB,EAAsB6B,YAAtB,EAAoCjB,OAApC,CAAtD;AAAA,CAAxB;;;;;"}